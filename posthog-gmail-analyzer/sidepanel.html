<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trace</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="header-left">
        <img src="icons/icon48.png" alt="Trace" class="logo-img">
        <h1>Trace</h1>
      </div>
      <div class="header-actions">
        <button id="refresh-btn" class="icon-btn" title="Refresh">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6"/>
            <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
          </svg>
        </button>
        <button id="settings-btn" class="icon-btn" title="Settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main id="content">
      <!-- Loading State -->
      <div id="loading" class="state">
        <div class="loading-animation">
          <div class="loading-circle"></div>
          <div class="loading-circle"></div>
          <div class="loading-circle"></div>
        </div>
        <p class="state-message" id="loading-message">Loading...</p>
        <p class="state-email" id="loading-email"></p>
      </div>

      <!-- Error State -->
      <div id="error" class="state hidden">
        <div class="state-icon error-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
        </div>
        <p class="state-message" id="error-message"></p>
        <p class="state-email" id="error-email"></p>
        <button id="setup-btn" class="btn-primary hidden">Open Settings</button>
      </div>

      <!-- Results State -->
      <div id="results" class="state hidden">
        <!-- User Card -->
        <div class="user-card">
          <div class="user-avatar" id="user-avatar">U</div>
          <div class="user-details">
            <p class="user-email" id="user-email"></p>
            <p class="user-meta"><span id="events-count">0</span> events</p>
          </div>
        </div>

        <!-- Subscription Status -->
        <div id="subscription-status" class="subscription-status hidden"></div>

        <!-- Session Recordings -->
        <div id="recordings-section" class="recordings-section hidden">
          <h2 class="section-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="23 7 16 12 23 17 23 7"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Session Recordings
          </h2>
          <div id="recordings-list" class="recordings-list"></div>
        </div>

        <!-- Events Timeline -->
        <div class="events-section">
          <h2 class="section-title">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
            Activity Timeline
          </h2>
          <div id="events-list" class="events-timeline"></div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="empty" class="state hidden">
        <div class="state-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M8 12h8"/>
          </svg>
        </div>
        <p class="state-message">No activity found</p>
        <p class="state-email" id="empty-email"></p>
        <p class="state-hint">This user has no tracked events in the last 2 days</p>
      </div>

      <!-- Initial/Not Gmail State -->
      <div id="initial" class="state hidden">
        <div class="state-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
        </div>
        <p class="state-message">Open an email in Gmail</p>
        <p class="state-hint">Click the Trace icon while viewing an email to see user activity</p>
      </div>
    </main>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
